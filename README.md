# Traffic Risk Prediction System

운수종사자의 인지적 특성 데이터를 활용한 교통사고 위험 예측 시스템

---

## 개요

본 시스템은 운수종사자의 자격검사 데이터를 분석하여 교통사고 위험을 예측하는 머신러닝 기반 추론 시스템입니다. 신규 자격검사(A)와 자격 유지 검사(B)의 인지·반응 데이터를 종합적으로 분석하여 위험군 속할 확률을 0~1 사이 값으로 출력합니다.

### 주요 특징

- **모듈화된 구조**: 명확한 역할 분리로 유지보수 및 확장 용이
- **배치 처리**: 대용량 데이터 효율적 처리 (10,000 samples/batch)
- **CPU 최적화**: 멀티스레딩 지원 (3 vCPU 기준)
- **메모리 효율**: 28GB RAM 환경에서 안정적 동작
- **오프라인 실행**: 인터넷 연결 없이 완전 독립 실행

---

## 시스템 구조

```
traffic_risk_prediction/
├── model/                      # 학습된 모델 저장소
│   ├── lgbm_A.pkl             # A검사 모델
│   └── lgbm_B.pkl             # B검사 모델
│
├── src/                        # 소스 코드 모듈
│   ├── __init__.py            # 패키지 초기화
│   ├── config.py              # 설정 관리
│   ├── data_loader.py         # 데이터 로딩
│   ├── preprocessor.py        # 전처리 파이프라인
│   ├── features.py            # 피처 엔지니어링
│   ├── predictor.py           # 모델 추론 엔진
│   └── utils.py               # 공통 유틸리티
│
├── script.py                   # 메인 실행 코드
├── requirements.txt            # 패키지 의존성
└── README.md                   # 프로젝트 문서
```

---

## 주요 기능

### 1. 데이터 처리
- CSV 파일 로딩 및 메모리 최적화
- A/B 검사 타입별 분리 처리
- 결측치 및 이상치 처리

### 2. 전처리 (Preprocessing)
- **A검사**: A1~A5 세부 검사 데이터 처리
- **B검사**: B1~B8 세부 검사 데이터 처리
- 시퀀스 데이터에서 통계량 추출

### 3. 피처 엔지니어링
- 반응시간 통계량 (평균, 표준편차, CV)
- 조건별 마스킹 평균 계산
- 속도-정확도 트레이드오프 지표
- 위험 점수 복합 지표

### 4. 모델 추론
- LightGBM 기반 이진 분류
- 배치 단위 예측으로 메모리 효율 확보
- 피처 정렬 및 검증

---

## 사용 방법

### 1. 데이터 준비
다음 구조로 데이터를 준비:
```
data/
├── test.csv          # 테스트 메타데이터
└── test/
    ├── A.csv         # A검사 상세 데이터
    └── B.csv         # B검사 상세 데이터
```

### 2. 모델 파일 배치
학습된 모델 파일을 `model/` 디렉터리에 배치합니다:
```
model/
├── lgbm_A.pkl
└── lgbm_B.pkl
```

### 3. 추론 실행
```bash
python script.py
```

### 4. 결과 확인
결과는 `output/submission.csv`에 저장됩니다:
```csv
Test_id,Label
T000001,0.234567
T000002,0.891234
...
```

---

## 시스템 요구사항

### 최소 사양
- **OS**: Ubuntu 22.04 LTS 또는 Windows 10+
- **CPU**: 3 vCPU
- **RAM**: 28GB
- **Python**: 3.10.12

### 권장 사양
- **CPU**: 6+ cores
- **RAM**: 32GB+
- **Storage**: 10GB 여유 공간

### 성능 특성
- **처리 속도**: 160,000 samples → 약 6-10분
- **메모리 사용량**: 약 6GB (28GB 중)
- **배치 크기**: 10,000 samples/batch

---

## 기술 스택

### 머신러닝
- **LightGBM**: Gradient boosting framework
- **scikit-learn**: 데이터 전처리 및 평가

### 데이터 처리
- **Pandas**: 데이터프레임 조작
- **NumPy**: 수치 연산

### 시스템
- **Python 3.10**: 프로그래밍 언어
- **joblib**: 모델 직렬화

---

## 모듈 설명

### config.py
- 전역 설정 관리
- 경로, 하이퍼파라미터, 로깅 설정

### data_loader.py
- CSV 파일 로딩
- 메모리 최적화 (데이터 타입 변환)
- 스키마 검증

### preprocessor.py
- A/B 검사별 전처리
- 시퀀스 데이터 통계량 추출
- 결측치 처리

### features.py
- 파생 피처 생성
- 통계적 집계
- 도메인 특화 피처

### predictor.py
- 모델 로딩 및 캐싱
- 배치 추론
- 피처 정렬

### utils.py
- 로깅 설정
- 예측 검증
- 공통 유틸리티 함수

---

## 데이터 명세

### 입력 데이터

#### test.csv
| 컬럼 | 설명 | 타입 |
|------|------|------|
| Test_id | 검사 식별 ID | string |
| Test | 검사 종류 (A/B) | string |

#### A.csv (신규 자격 검사)
- Test_id, PrimaryKey, Age, TestDate
- A1-1 ~ A1-4: 검사 A1 세부 데이터
- A2-1 ~ A2-4: 검사 A2 세부 데이터
- A3-1 ~ A3-7: 검사 A3 세부 데이터
- A4-1 ~ A4-5: 검사 A4 세부 데이터
- A5-1 ~ A5-3: 검사 A5 세부 데이터

#### B.csv (자격 유지 검사)
- Test_id, PrimaryKey, Age, TestDate
- B1-1 ~ B1-3: 검사 B1 세부 데이터
- B2-1 ~ B2-3: 검사 B2 세부 데이터
- B3-1 ~ B3-2: 검사 B3 세부 데이터
- B4-1 ~ B4-2: 검사 B4 세부 데이터
- B5-1 ~ B5-2: 검사 B5 세부 데이터
- B6, B7, B8: 추가 검사 데이터

### 출력 데이터

#### submission.csv
| 컬럼 | 설명 | 타입 | 범위 |
|------|------|------|------|
| Test_id | 검사 식별 ID | string | - |
| Label | 위험군 속할 확률 | float | 0.0 ~ 1.0 |
